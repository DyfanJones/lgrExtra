---
title: "lgrExtra"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{lgrExtra}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette is very much work in progress and will contain more examples in
the future.


# AppenderDbi - Logging to databases

[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)

Appending to databases is supported but still experimental. Please be aware
that the API might change and AppenderDbi and its subclasses are not fit
for production use.

```{r setup}
library(lgr)
library(lgrExtra)
library(RSQLite)

lo <- LayoutDbi$new(
  serialized_cols = list(fields = SerializerJson$new()),
  col_types = c(
    level = "INTEGER",
    timestamp = "TEXT",
    logger= "TEXT",
    msg = "TEXT",
    caller = "TEXT",
    foo = "TEXT",
    fields = "TEXT"
  )
)

ap <- lgrExtra::AppenderDbi$new(
  conn = DBI::dbConnect(RSQLite::SQLite(), 'log.db'),
  table = "log",
  layout = lo,

)

lg <- get_logger("test")$add_appender(ap)
  
lg$info("test", foo = "bar", hash = "baz")  

x <- DBI::dbGetQuery(ap$conn, "select * from log")
x  

```

